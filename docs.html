<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MapleSchema ‚Äî Developer Documentation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="Developer documentation for MapleSchema ‚Äî schema-first transaction normalization. Learn authentication (Project ID + API key), /v1/transactions/transform request/response, and optional Insights."
  />

  <!-- SEO + Social -->
  <meta property="og:title" content="MapleSchema ‚Äî Developer Documentation">
  <meta property="og:description" content="How to call /v1/transactions/transform with Project ID + API key, consume the canonical transaction schema, and enable optional Insights.">
  <meta property="og:url" content="https://mapleschema.com/docs.html">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://mapleschema.com/images/mapleschema-social.png">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">

  <!-- Main stylesheet -->
  <link rel="stylesheet" href="/css/style.css" />

  <!-- Small, self-contained helpers -->
  <style>
    .code-block { position: relative; text-align: left; }
    .copy-btn {
      position: absolute; top: 0.75rem; right: 0.75rem;
      font-size: 0.75rem; padding: 0.35rem 0.6rem;
      border: none; border-radius: 4px;
      background: #2f80ed; color: white;
      cursor: pointer; opacity: 0.9; line-height: 1;
    }
    .copy-btn:hover { opacity: 1; }
    .copy-btn:disabled { background: #27ae60; cursor: default; opacity: 1; }

    /* Simple two-column table (Field path / Meaning) */
    .ms-table {
      margin-top: 10px;
      border: 1px solid rgba(0,0,0,0.12);
      border-radius: 12px;
      overflow: hidden;
      background: rgba(255,255,255,0.55);
    }
    .ms-table-head, .ms-table-row {
      display: grid;
      grid-template-columns: minmax(260px, 1fr) minmax(260px, 2fr);
    }
    .ms-table-head {
      border-bottom: 1px solid rgba(0,0,0,0.08);
      background: rgba(255,255,255,0.35);
    }
    .ms-table-row { border-bottom: 1px solid rgba(0,0,0,0.08); }
    .ms-table-row:last-child { border-bottom: none; }
    .ms-cell { padding: 10px 12px; }
    .ms-key { font-weight: 900; }

    /* Insights card emphasis */
    .ms-pill {
      display:inline-block;
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      background: rgba(0,0,0,0.06);
      border: 1px solid rgba(0,0,0,0.08);
    }
  </style>
</head>

<body>
<div id="site">

  <header>
    <div class="container header-inner">
      <a href="/index.html" class="logo-link">
        <div class="logo-wrapper">
          <img src="/images/mapleschema-transparent-icon.png" class="logo" alt="MapleSchema logo">
        </div>
      </a>

      <nav>
        <a href="/docs.html">Docs</a>
        <a href="/security.html">Security</a>
        <a href="/contact.html">Contact</a>
      </nav>
    </div>
  </header>

  <main class="container">

    <!-- HERO -->
    <section class="hero">
      <h1>Developer Docs</h1>

      <p class="hero-lead">
        MapleSchema normalizes upstream banking transaction payloads into a single deterministic transaction contract.
        This page covers authentication (Project ID + API key), the <code>/v1/transactions/transform</code> endpoint,
        and optional <strong>Insights</strong>.
      </p>

      <p class="small">
        This is infrastructure-style documentation: stable contract, predictable failure modes, and minimal surprises.
      </p>
    </section>

    <!-- QUICKSTART -->
    <section class="card" style="text-align:center;">
      <h2>Quickstart</h2>

      <p class="small">
        Send an upstream payload to <code>/v1/transactions/transform</code>.
        Authenticate using <strong>Project ID</strong> + <strong>API key</strong>.
      </p>

      <p style="margin-top:14px;">
        <a href="/contact.html" class="button-primary">Request Enterprise Access</a>
      </p>

      <hr style="margin:2rem 0; opacity:0.3;" />

      <h3>Example: Transform a payload</h3>

      <p class="small">
        The command below posts a payload and returns a deterministic batch response.
      </p>

      <p class="small"><strong>Request (curl)</strong></p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)" aria-label="Copy curl command">Copy</button>
<pre><code class="language-bash">curl -X POST https://api.mapleschema.com/v1/transactions/transform \
  -H "X-Project-Id: YOUR_PROJECT_ID" \
  -H "X-Api-Key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d @transactions.json
</code></pre>
      </div>

      <p class="small">
        Save the JSON below as <code>transactions.json</code>, then run the command.
        Replace <code>YOUR_PROJECT_ID</code> and <code>YOUR_API_KEY</code> with values issued to your org.
      </p>

      <p class="small"><strong>Sample Input (transactions.json)</strong></p>
      <div class="code-block">
        <button class="copy-btn" onclick="copyCode(this)" aria-label="Copy sample JSON payload">Copy</button>
<pre><code class="language-json">{
  "aggregator_code": "flinks",
  "institution_code": "rbc_ca",
  "payload": {
    "Data": {
      "Transaction": [
        {
          "AccountId": "chq_001",
          "TransactionId": "stmt_line_1842",
          "TransactionReference": "stmt_line_1842",
          "Amount": { "Amount": "7.24", "Currency": "CAD" },
          "CreditDebitIndicator": "Debit",
          "Status": "Booked",
          "BookingDateTime": "2026-01-14T19:22:11Z",
          "ValueDateTime": "2026-01-14T19:22:11Z",
          "TransactionInformation": "TIM HORTONS #0059 / LONDON ON",
          "ProprietaryBankTransactionCode": { "Code": "POS", "Issuer": "rbc_ca" }
        }
      ]
    },
    "Links": { "Self": "https://api.flinks.com/transactions" },
    "Meta": {
      "TotalPages": 1,
      "FirstAvailableDateTime": "2026-01-01T00:00:00Z",
      "LastAvailableDateTime": "2026-01-31T23:59:59Z"
    }
  }
}</code></pre>
      </div>
    </section>

    <!-- AUTH -->
    <section class="docs-section">
      <article class="card">
        <h2>üîë Authentication</h2>

        <p>
          Enterprise calls use a <strong>Project model</strong>. Every request must include:
        </p>

        <ul>
          <li><strong>X-Project-Id</strong> ‚Äî identifies which project/environment is calling (e.g. <code>prod-ledger</code>, <code>analytics</code>)</li>
          <li><strong>X-Api-Key</strong> ‚Äî authorizes that project‚Äôs usage</li>
        </ul>

<pre>X-Project-Id: YOUR_PROJECT_ID
X-Api-Key: YOUR_API_KEY</pre>

        <p class="small">
          Missing or invalid credentials return a deterministic auth error.
        </p>
      </article>

      <article class="card">
        <h2>üîÅ Transform Endpoint</h2>

        <ul>
          <li><strong>Method</strong>: <code>POST</code></li>
          <li><strong>Path</strong>: <code>/v1/transactions/transform</code></li>
          <li><strong>Content-Type</strong>: <code>application/json</code></li>
          <li><strong>Auth</strong>: <code>X-Project-Id</code> + <code>X-Api-Key</code></li>
        </ul>

        <p class="small">
          The API accepts either:
          <strong>(A)</strong> raw <code>transactions</code> array, or
          <strong>(B)</strong> a full upstream <code>payload</code> object plus extraction context.
        </p>
      </article>
    </section>

    <!-- REQUEST BODY -->
    <section class="docs-section">
      <article class="card">
        <h2>üì• Request Body</h2>

        <p>
          You can send transactions in two ways:
        </p>

        <h3 style="margin-bottom:8px;">A) Provide <code>transactions</code> directly</h3>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)" aria-label="Copy direct transactions example">Copy</button>
<pre><code class="language-json">{
  "aggregator_code": "flinks",
  "institution_code": "rbc_ca",
  "transactions": [
    { "AccountId": "chq_001", "TransactionId": "stmt_line_1842", "Amount": { "Amount": "7.24", "Currency": "CAD" }, "CreditDebitIndicator": "Debit", "BookingDateTime": "2026-01-14T19:22:11Z", "TransactionInformation": "TIM HORTONS #0059 / LONDON ON" }
  ]
}</code></pre>
        </div>

        <h3 style="margin:18px 0 8px;">B) Provide a full upstream <code>payload</code></h3>
        <p class="small">
          This is useful when you want MapleSchema to extract <code>Data.Transaction</code> (or another path) for you.
        </p>

        <div class="ms-table">
          <div class="ms-table-head">
            <div class="small ms-cell ms-key">Field</div>
            <div class="small ms-cell ms-key">Meaning</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">aggregator_code</div>
            <div class="small ms-cell">Upstream provider identifier (e.g. <code>flinks</code>)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">institution_code</div>
            <div class="small ms-cell">Institution mapping to apply (e.g. <code>rbc_ca</code>)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">payload</div>
            <div class="small ms-cell">Full upstream object containing a transactions array somewhere inside</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">transactions_path</div>
            <div class="small ms-cell"><span class="ms-pill">optional</span> Dot-path to the transactions array (defaults to provider strategy)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">include_insights</div>
            <div class="small ms-cell"><span class="ms-pill">optional</span> If true, request Insights annotations (paid/enterprise only)</div>
          </div>
        </div>

        <p class="small" style="margin-top:10px;">
          If you omit both <code>transactions</code> and <code>payload</code>, the API returns a client error.
        </p>
      </article>
    </section>

    <!-- RESPONSE -->
    <section class="docs-section">
      <article class="card">
        <h2>üì§ Response Body</h2>

        <p>
          The API returns a batch response:
        </p>

        <ul>
          <li><code>metadata</code> ‚Äî request diagnostics and counts</li>
          <li><code>transactions</code> ‚Äî deterministic, canonical transactions (sorted stably)</li>
        </ul>

        <p class="small"><strong>Sample Output (trimmed)</strong></p>
        <div class="code-block">
          <button class="copy-btn" onclick="copyCode(this)" aria-label="Copy sample output">Copy</button>
<pre><code class="language-json">{
  "metadata": {
    "request_id": "req_123",
    "institution_code": "rbc_ca",
    "received_at": "2026-01-14T19:22:12Z",
    "processed_at": "2026-01-14T19:22:12Z",
    "input_count": 1,
    "output_count": 1,
    "failed_count": 0
  },
  "transactions": [
    {
      "schema_version": "transactions-v1.0",
      "transaction_fingerprint": "ms_fp_9f1c2c7b0d2a",
      "transaction_ref": "stmt_line_1842",
      "account_ref": "chq_001",
      "institution_code": "rbc_ca",
      "aggregator_code": "flinks",
      "effective_at": "2026-01-14T19:22:11Z",
      "posted_at": "2026-01-14T19:22:11Z",
      "amount": { "amount_minor": 724, "amount_raw": -7.24, "currency": "CAD" },
      "direction": "debit",
      "original_description": "TIM HORTONS #0059 / LONDON ON",
      "status": "posted",
      "mutability": "unknown",
      "normalization": { "mapping_method": "direct", "warnings": [], "input_timezone": "Z" },
      "insights": null,
      "extras": {}
    }
  ]
}</code></pre>
        </div>

        <p class="small">
          Notes:
          <strong>amount.amount_minor</strong> is an unsigned magnitude; sign is conveyed by <strong>direction</strong> and <strong>amount.amount_raw</strong>.
          Timestamps are normalized to UTC.
        </p>
      </article>

      <article class="card">
        <h2>üßæ Canonical Transaction Fields (dot notation)</h2>

        <p class="small">
          These are the fields most downstream systems depend on. Values shown match the sample input/output above.
        </p>

        <div class="ms-table">
          <div class="ms-table-head">
            <div class="small ms-cell ms-key">Field path</div>
            <div class="small ms-cell ms-key">Meaning</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">schema_version</div>
            <div class="small ms-cell">Contract version (currently <code>transactions-v1.0</code>)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">transaction_fingerprint</div>
            <div class="small ms-cell">Stable fingerprint used for batch collision detection</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">transaction_ref</div>
            <div class="small ms-cell">Optional caller-owned transaction reference (echoed if provided)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">account_ref</div>
            <div class="small ms-cell">Optional caller-owned account reference (echoed if provided)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">institution_code</div>
            <div class="small ms-cell">Institution adapter used for normalization</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">aggregator_code</div>
            <div class="small ms-cell">Upstream provider identifier</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">effective_at</div>
            <div class="small ms-cell">Required canonical timestamp (posted/value/authorized in UTC)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">posted_at</div>
            <div class="small ms-cell">Posted time in UTC (nullable if not provided upstream)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">amount.amount_minor</div>
            <div class="small ms-cell">Unsigned magnitude in minor units (e.g. cents)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">amount.amount_raw</div>
            <div class="small ms-cell">Signed decimal value (helps humans; downstream should prefer minor+direction)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">amount.currency</div>
            <div class="small ms-cell">ISO currency code (e.g. CAD)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">direction</div>
            <div class="small ms-cell"><code>debit</code> or <code>credit</code></div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">original_description</div>
            <div class="small ms-cell">Raw upstream description line</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">status</div>
            <div class="small ms-cell">Normalized ledger inclusion status (e.g. posted/pending)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">mutability</div>
            <div class="small ms-cell">Mutability indicator (currently <code>unknown</code> unless upstream signals are present)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">normalization.mapping_method</div>
            <div class="small ms-cell">Mapping method used to produce the normalized object</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">normalization.warnings</div>
            <div class="small ms-cell">Best-effort warnings for diagnostics (array)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">normalization.input_timezone</div>
            <div class="small ms-cell">Timezone derived from upstream timestamp offset</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">extras</div>
            <div class="small ms-cell">Passthrough metadata (includes internal <code>_ms</code> diagnostics when available)</div>
          </div>
        </div>
      </article>
    </section>

    <!-- INSIGHTS -->
    <section class="docs-section">
      <article class="card primary">
        <h2>‚ú® Insights (optional)</h2>

        <p>
          Insights are optional annotations on top of the canonical transaction.
          They never change core fields. They are best-effort: on provider failure, MapleSchema degrades to safe defaults.
        </p>

        <div class="ms-table">
          <div class="ms-table-head">
            <div class="small ms-cell ms-key">Field path</div>
            <div class="small ms-cell ms-key">Meaning</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">include_insights</div>
            <div class="small ms-cell">Request flag (true/false). When true, Insights may be populated.</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.category.value</div>
            <div class="small ms-cell">Category enum value (e.g. <code>coffee_fast_food</code>)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.category.confidence</div>
            <div class="small ms-cell">0..1 confidence score</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.category.version</div>
            <div class="small ms-cell">Insights version identifier</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.category.signals</div>
            <div class="small ms-cell">Short explanations (array of strings)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.category.model.provider</div>
            <div class="small ms-cell">Provider name (e.g. <code>gemini</code>)</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.category.model.model</div>
            <div class="small ms-cell">Provider model identifier</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.category.model.latency_ms</div>
            <div class="small ms-cell">Best-effort latency annotation</div>
          </div>

          <div class="ms-table-row">
            <div class="small ms-cell ms-key">insights.description</div>
            <div class="small ms-cell">Best-effort cleaned description (must be short and non-speculative)</div>
          </div>
        </div>

        <p class="small" style="margin-top:10px;">
          To request Insights, add <code>"include_insights": true</code> to your request body.
          If Insights are not available, the API may return <code>INS_toggle error</code> for requests that require it.
        </p>

        <p class="small muted">
          Enterprise: Insights availability depends on your project configuration and entitlements.
        </p>
      </article>
    </section>

    <!-- ERRORS -->
    <section class="docs-section">
      <article class="card">
        <h2>‚ö†Ô∏è Errors &amp; limits</h2>

        <p class="small">
          The API returns typed errors with a stable <code>code</code>, a human-safe message, and a <code>request_id</code>.
          When a failure occurs during extraction or mapping, the response includes diagnostics (e.g. candidate paths, failed indexes).
        </p>

        <p class="small">
          Transaction limits may apply per request. If you exceed caps, the API returns <code>TX_LIMIT_EXCEEDED</code> (hard cap)
          or <code>FREE_TX_LIMIT_EXCEEDED</code> (free/core flows).
        </p>
      </article>
    </section>

  </main>

  <footer>
    ¬© MapleSchema 2026 ‚Äî Schema-first transaction normalization ‚Ä¢
    <a href="/enterprise">Enterprise</a>
  </footer>

</div>

<script>
  function copyCode(button) {
    const wrapper = button.closest(".code-block");
    const codeEl = wrapper ? wrapper.querySelector("code") : null;
    const text = codeEl ? codeEl.innerText : "";
    if (!text) return;

    navigator.clipboard.writeText(text).then(() => {
      const original = button.textContent;
      button.textContent = "Copied ‚úì";
      button.disabled = true;
      setTimeout(() => {
        button.textContent = original;
        button.disabled = false;
      }, 1500);
    });
  }
</script>

</body>
</html>
